<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>对SpringGateway+Security+OAuth2.0的认识 &#183; Vee's space</title><meta name=description content><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/print.css media=print><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/poole.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/syntax.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href=https://vee-zhang.github.io/%E5%AF%B9springgateway-security-oauth2-0%E7%9A%84%E8%AE%A4%E8%AF%86/index.md rel=alternate type=text/plain title="Vee's space"></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vee-zhang.github.io><h1>Vee's space</h1></a><p class=lead>关于 DoIt 主题</p></div><nav><ul class=sidebar-nav><li><a href=https://vee-zhang.github.io>Home</a></li><li><a href=/posts/>所有文章</a></li><li><a href=/tags/>标签</a></li><li><a href=/categories/>分类</a></li><li><a href=/series/>系列</a></li><li><a href=/about/>关于</a></li></ul></nav><p>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</p></div></aside><main class="content container"><div class=post><h1>对SpringGateway+Security+OAuth2.0的认识</h1><time datetime=2021-01-12T17:49:10Z class=post-date>Tue, Jan 12, 2021</time><p>趁着下载Keycloak的时候，记录一下自己对SpringCloud中的用户鉴权系统的认识。</p><h2 id=oauth20-四种授权模式>OAuth2.0 四种授权模式</h2><table><thead><tr><th>模式</th><th>refresh_token</th><th>用途</th></tr></thead><tbody><tr><td>authorization_code</td><td>true</td><td>允许用户通过第三方应用登录自身获取资源，前提是用户已登录自身服务。</td></tr><tr><td>implicit</td><td>false</td><td>简化模式，跳过了获取授权码过程。</td></tr><tr><td>password</td><td>true</td><td>账号密码模式，用于高度授信场景，比如登录微信、QQ自身｜</td></tr><tr><td>client_credentials</td><td>false</td><td>客户端模式，用于高度授信的其他服务，如企业自己的其他服务，或高度加密的硬件客户端，登录过程完全不需要用户操作。</td></tr></tbody></table><h2 id=securityresourceserverclientserver各自的作用和关系>Security、ResourceServer、ClientServer各自的作用和关系</h2><ul><li><p>SpringSecurity:鉴权方式的配置，比如哪些接口需要鉴权，还要排除调登录注册和登出接口等等。还有用户信息的存放、认证，Token Provider 的配置等等。</p></li><li><p>ResourceServer:是指需要收到保护的资源。比我的一个服务有大量接口，需要采用Security保护，那这个服务就是个ResourceServer。怎么保护呢？通过集成SpringSecurity来保护。每当有请求要访问我们的接口，ResourceServer都需要向token_provider验证token的有效性。</p></li><li><p>ClientServer:是用来在服务端获取access_token和refresh_token用的，并且可以自动使用refresh_token去刷新access_token。向谁获取？可以是微信、微博、github等等。</p></li><li><p>TokenProvider:用来提供token的服务。比如微信、支付宝、github,也可以是自己搭建的Keycloak服务。</p></li></ul><h2 id=网关统一用户认证>网关统一用户认证</h2><p>很简单，说白了就是在Gateway集成Security，这样以来Gateway就成了一个ResourceServer，并且可以为所有路由做用户认证。</p><p>但是！<strong>具体的鉴权还是需要各个服务自己去做</strong>，毕竟网关不知道具体的服务需要具体哪一项权限。</p><h2 id=faq>FAQ</h2><h3 id=直接使用微信支付宝的token来做自己的有效性验证可以码>直接使用微信、支付宝的token来做自己的有效性验证可以码？</h3><p>当然可以！只不过，人家的token验证只有在调用他们的服务时才会生效，如果不调用他们的服务，我们自己不知道人家的token是否有效（超时过期）。</p><p>那么该怎么实现？当我们自己的接口被访问时，先去调个人家的服务，最好是无关痛痒的服务，单纯为了验证人家的token是否有效。</p><p>但是这样以来就大大降低了接口的请求速度，而且也不优雅，平衡下来还不许自己搭建帐号体系来的实在！</p><h3 id=采用授权码方式让自己的客户端访问自己服务>采用授权码方式让自己的客户端访问自己服务？</h3><p>这就叫脱了裤子放屁，为安全而安全！</p><p>用微信的第三方登录举例，假如我们没有登录微信，当使用微信时，依然需要用帐号密码方式先登录微信。因为你在操作授权登录时，是先调起微信的页面或者它SDK的页面，是在人家的页面里面玩的，对于微信来讲，他自己的页面就是高度授信的，所以追本溯源，授权码登录方式还是基于帐号密码之上的。</p></div></main></body></html>