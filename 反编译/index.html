<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Apk反编译流程 &#183; Vee's space</title><meta name=description content><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/print.css media=print><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/poole.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/syntax.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href=https://vee-zhang.github.io/%E5%8F%8D%E7%BC%96%E8%AF%91/index.md rel=alternate type=text/plain title="Vee's space"></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vee-zhang.github.io><h1>Vee's space</h1></a><p class=lead>关于 DoIt 主题</p></div><nav><ul class=sidebar-nav><li><a href=https://vee-zhang.github.io>Home</a></li><li><a href=/posts/>所有文章</a></li><li><a href=/tags/>标签</a></li><li><a href=/categories/>分类</a></li><li><a href=/series/>系列</a></li><li><a href=/about/>关于</a></li></ul></nav><p>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</p></div></aside><main class="content container"><div class=post><h1>Apk反编译流程</h1><time datetime=2021-06-21T17:49:10Z class=post-date>Mon, Jun 21, 2021</time><h2 id=apk文件的组成>.apk文件的组成</h2><p>apk文件其实就是个压缩包，里面包含：</p><ul><li>classes.dex文件</li><li>resource</li></ul><h2 id=打包流程>打包流程</h2><ol><li>aapt编译打包资源文件，生成<code>R.java</code>。<ol><li>编译AndroidManifest成二进制；</li><li>编译layout等xml文件，生成<code>R.java</code>，和<code>resource.arsc</code>文件。</li></ol></li><li>处理aidl文件，生成对应的.java文件。</li><li>java编译器（javac）编译项目源码，生成.class文件，位于bin/classes目录下；</li><li>Android编译器使用dx工具整合所有的class文件生成<code>classes.dex</code>文件；</li><li>由<code>apkbuilder</code>打包生成apk；</li><li>对包签名；</li><li>对齐处理，将包中的资源文件距离文件起始偏移为4字节的整数倍，这样通过内存映射访问apk文件时可提高速度，减少运行时内存的使用。</li></ol><h2 id=安装流程>安装流程</h2><p>核心类：<code>PMS</code>(PackageManagerService)</p><ol><li>复制apk到<code>data/app</code>目录下，解压并扫描安装包，把classes.dex文件保存到dalvik-cache目录，并再data/data目录下创建对应的应用数据目录；</li><li>解析AndroidManifinest，提取信息写入<code>/data/system/packages.xml</code>；</li><li>Launcher加载桌面图标；</li></ol><h2 id=apk安装方式>APK安装方式</h2><table><thead><tr><th>方式</th><th>有无界面</th></tr></thead><tbody><tr><td>系统应用</td><td>无</td></tr><tr><td>market应用下载</td><td>无</td></tr><tr><td>第三方下载</td><td>有</td></tr><tr><td>adb</td><td>无</td></tr></tbody></table></div></main></body></html>