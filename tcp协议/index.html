<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>TCP协议 &#183; Vee's space</title><meta name=description content><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/print.css media=print><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/poole.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/syntax.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href=https://vee-zhang.github.io/tcp%E5%8D%8F%E8%AE%AE/index.md rel=alternate type=text/plain title="Vee's space"></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vee-zhang.github.io><h1>Vee's space</h1></a><p class=lead>关于 DoIt 主题</p></div><nav><ul class=sidebar-nav><li><a href=https://vee-zhang.github.io>Home</a></li><li><a href=/posts/>所有文章</a></li><li><a href=/tags/>标签</a></li><li><a href=/categories/>分类</a></li><li><a href=/series/>系列</a></li><li><a href=/about/>关于</a></li></ul></nav><p>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</p></div></aside><main class="content container"><div class=post><h1>TCP协议</h1><time datetime=2023-03-06T13:29:40+0800 class=post-date>Mon, Mar 6, 2023</time><h2 id=三次握手>三次握手</h2><p><img src=tcp%E6%8F%A1%E6%89%8B%E8%BF%87%E7%A8%8B.png alt=tcp握手过程></p><p><img src=%E6%8A%93%E5%8C%85%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png alt=抓包三次握手></p><ol><li>client->server:443 : [SYN] Seq=0</li><li>server:443->client : [SYN,ACK] Seq=0 Ack=1</li><li>client->server:443 : [ACK] Seq=1 Ack=1</li></ol><h3 id=第一次握手clent-server>第一次握手：clent->server</h3><p>客户端向服务器发送：</p><ul><li>[SYN]：标志位，表示请求建立连接</li><li>Seq=0：数据包的相对序列号，初始为0，为0表示当前还没有发送数据</li><li>Ack=0：已收到包的数量，初始为0，为0表示当前没有收到包</li></ul><h3 id=第二次握手server-client>第二次握手：server->client</h3><p>服务端向客户端回复：</p><ul><li>[SYN, ACK]：标志位，表示已收到连接请求，并已回复</li><li>Seq=0：表示还没有发送实际的数据</li><li>Ack=1：表示已收到1个包，这个包就是第一次握手时收到的包，虽然没有实际数据</li></ul><h3 id=第三次握手client-server>第三次握手:client->server</h3><p>客户端再次发送确认包(Ack)SYN标志位为0，ACK标志位为1，并把服务器发送来的ACK序号+1</p><ul><li>[ACK]：标志位，表示已经收到记录</li><li>Seq=1：表示当前已经发送1个数据包</li><li>Ack=1：表示已收到数据的位数为1</li></ul><blockquote><p>三次握手之后，直接就开始SSL握手，然后是正常数据交互，当没有交互时，还会连接保活(keep alive)，当保活一定的时间之后，就开始四次挥手了。</p></blockquote><h2 id=四次挥手>四次挥手</h2><p><img src=%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%BF%87%E7%A8%8B.png alt=四次挥手过程></p><blockquote><p>目前我实际抓包下来，发现与网络上的对不上，可能是受到了keepAlive的干扰。目前了解到的信息是，由于是全双工通信，服务端和客户端都可以主动结束连接，其他的过程后面再补吧。</p></blockquote></div></main></body></html>