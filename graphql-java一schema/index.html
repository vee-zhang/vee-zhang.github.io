<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>GraphQl-Java(一)Schema &#183; Vee's space</title><meta name=description content="本文基于GraphQl-java:v1.6版本官方文档中文翻译。"><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/print.css media=print><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/poole.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/syntax.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href=https://vee-zhang.github.io/graphql-java%E4%B8%80schema/index.md rel=alternate type=text/plain title="Vee's space"></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vee-zhang.github.io><h1>Vee's space</h1></a><p class=lead>关于 DoIt 主题</p></div><nav><ul class=sidebar-nav><li><a href=https://vee-zhang.github.io>Home</a></li><li><a href=/posts/>所有文章</a></li><li><a href=/tags/>标签</a></li><li><a href=/categories/>分类</a></li><li><a href=/series/>系列</a></li><li><a href=/about/>关于</a></li></ul></nav><p>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</p></div></aside><main class="content container"><div class=post><h1>GraphQl-Java(一)Schema</h1><time datetime=2021-01-19T10:13:53Z class=post-date>Tue, Jan 19, 2021</time><h2 id=引入依赖>引入依赖</h2><p><a href=https://github.com/graphql-java/graphql-java/releases>版本列表</a></p><h3 id=gradle>Gradle</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>repositories {
</span></span><span class=line><span class=cl>    mavenCentral()
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dependencies {
</span></span><span class=line><span class=cl>    compile &#39;com.graphql-java:graphql-java:15.0&#39;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=maven>Maven</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>com.graphql-java<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>graphql-java<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>15.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=schema大纲>Schema——大纲</h2><p>创建一个Schema有两种方式：</p><ol><li><p>推荐SDL(special graphql dsl):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type Foo {
</span></span><span class=line><span class=cl>    bar: String
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div></li><li><p>java code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GraphQLObjectType</span> <span class=n>fooType</span> <span class=o>=</span> <span class=n>newObject</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;Foo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newFieldDefinition</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLString</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=datafetcher-and-typeresolver>DataFetcher and TypeResolver</h2><p><code>DataFetcher</code>用来向field提供数据，每一个<code>field</code>都包含一个DataFetcher,默认采用<code>PropertyDataFetcher</code>。</p><p><code>PropertyDataFetcher</code> 从<code>Map</code>或者<code>Java Bean</code>中获取数据，所以当field name与map的key，或者类的元素名称的相匹配，就不需要定义<code>DataFetcher</code>了。</p><p><code>TypeResolver</code>帮助<code>graphql-java</code>判断值的类型。</p><p>想象一下，你有一个接口MagicUserType，用来解析一系列java类Wizard,Witch和Necromancer。类型检查器负责检查一个运行时对象，并且判断用哪个<code>GraphqlObjectType</code>去响应这个对象，对应的应该用哪个<code>data fetchers</code>和field去运行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>new</span> <span class=n>TypeResolver</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>GraphQLObjectType</span> <span class=nf>getType</span><span class=o>(</span><span class=n>TypeResolutionEnvironment</span> <span class=n>env</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>javaObject</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=na>getObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>javaObject</span> <span class=k>instanceof</span> <span class=n>Wizard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>env</span><span class=o>.</span><span class=na>getSchema</span><span class=o>().</span><span class=na>getObjectType</span><span class=o>(</span><span class=s>&#34;WizardType&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>javaObject</span> <span class=k>instanceof</span> <span class=n>Witch</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>env</span><span class=o>.</span><span class=na>getSchema</span><span class=o>().</span><span class=na>getObjectType</span><span class=o>(</span><span class=s>&#34;WitchType&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>env</span><span class=o>.</span><span class=na>getSchema</span><span class=o>().</span><span class=na>getObjectType</span><span class=o>(</span><span class=s>&#34;NecromancerType&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=用sdl创建一个schema>用SDL创建一个Schema</h2><p>当通过schema创建一个SDL，你应该定义好<code>DataFetcher</code>和<code>TypeResolver</code>。</p><p>比如创建一个starWarsSchema.graphqls:</p><blockquote><p>这货是星战迷，日了，好多电影里自创的名词。幸亏前阵子看了《曼达洛人》，要不然都翻译不了这破官文。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>schema {
</span></span><span class=line><span class=cl>    query: QueryType
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>type QueryType {
</span></span><span class=line><span class=cl>    hero(episode: Episode): Character //英雄
</span></span><span class=line><span class=cl>    human(id : String) : Human  //人类
</span></span><span class=line><span class=cl>    droid(id: ID!): Droid   //德鲁伊
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//BGM枚举
</span></span><span class=line><span class=cl>enum Episode {
</span></span><span class=line><span class=cl>    NEWHOPE //新希望军
</span></span><span class=line><span class=cl>    EMPIRE  //帝国军
</span></span><span class=line><span class=cl>    JEDI    //绝地武士
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//角色接口
</span></span><span class=line><span class=cl>interface Character {
</span></span><span class=line><span class=cl>    id: ID!
</span></span><span class=line><span class=cl>    name: String!
</span></span><span class=line><span class=cl>    friends: [Character]
</span></span><span class=line><span class=cl>    appearsIn: [Episode]! //出现的时候播放对应的BGM
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>type Human implements Character {
</span></span><span class=line><span class=cl>    id: ID!
</span></span><span class=line><span class=cl>    name: String!
</span></span><span class=line><span class=cl>    friends: [Character]
</span></span><span class=line><span class=cl>    appearsIn: [Episode]!
</span></span><span class=line><span class=cl>    homePlanet: String  //母星
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>type Droid implements Character {
</span></span><span class=line><span class=cl>    id: ID!
</span></span><span class=line><span class=cl>    name: String!
</span></span><span class=line><span class=cl>    friends: [Character]
</span></span><span class=line><span class=cl>    appearsIn: [Episode]!
</span></span><span class=line><span class=cl>    primaryFunction: String //超能力
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>这个静态文件<code>starWarsSchema.graphqls</code>包含了field和type的定义，但是你还需要一个<code>runtimeWiring（运行时注入）</code>来把这个静态文件转换为一个可运行的schema。</p><p><code>runtimeWiring</code>必须包含<code>DataFetcher</code>、<code>TypeResolver</code>和自定义的<code>Scalar</code>。</p><p>你可以用下面的建造者模式+lambda表达式去创建报文：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl> <span class=n>RuntimeWiring</span> <span class=nf>buildRuntimeWiring</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>RuntimeWiring</span><span class=o>.</span><span class=na>newRuntimeWiring</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>scalar</span><span class=o>(</span><span class=n>CustomScalar</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=c1>// this uses builder function lambda syntax
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=s>&#34;QueryType&#34;</span><span class=o>,</span> <span class=n>typeWiring</span> <span class=o>-&gt;</span> <span class=n>typeWiring</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>dataFetcher</span><span class=o>(</span><span class=s>&#34;hero&#34;</span><span class=o>,</span> <span class=k>new</span> <span class=n>StaticDataFetcher</span><span class=o>(</span><span class=n>StarWarsData</span><span class=o>.</span><span class=na>getArtoo</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>dataFetcher</span><span class=o>(</span><span class=s>&#34;human&#34;</span><span class=o>,</span> <span class=n>StarWarsData</span><span class=o>.</span><span class=na>getHumanDataFetcher</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>dataFetcher</span><span class=o>(</span><span class=s>&#34;droid&#34;</span><span class=o>,</span> <span class=n>StarWarsData</span><span class=o>.</span><span class=na>getDroidDataFetcher</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=s>&#34;Human&#34;</span><span class=o>,</span> <span class=n>typeWiring</span> <span class=o>-&gt;</span> <span class=n>typeWiring</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>dataFetcher</span><span class=o>(</span><span class=s>&#34;friends&#34;</span><span class=o>,</span> <span class=n>StarWarsData</span><span class=o>.</span><span class=na>getFriendsDataFetcher</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=c1>// you can use builder syntax if you don&#39;t like the lambda syntax
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=s>&#34;Droid&#34;</span><span class=o>,</span> <span class=n>typeWiring</span> <span class=o>-&gt;</span> <span class=n>typeWiring</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>dataFetcher</span><span class=o>(</span><span class=s>&#34;friends&#34;</span><span class=o>,</span> <span class=n>StarWarsData</span><span class=o>.</span><span class=na>getFriendsDataFetcher</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=c1>// or full builder syntax if that takes your fancy
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=o>.</span><span class=na>type</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>newTypeWiring</span><span class=o>(</span><span class=s>&#34;Character&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>typeResolver</span><span class=o>(</span><span class=n>StarWarsData</span><span class=o>.</span><span class=na>getCharacterTypeResolver</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>build</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最终，你可以把静态的大纲和注入结合到一起来创建一个可运行的schema：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>SchemaParser</span> <span class=n>schemaParser</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SchemaParser</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>SchemaGenerator</span> <span class=n>schemaGenerator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SchemaGenerator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>File</span> <span class=n>schemaFile</span> <span class=o>=</span> <span class=n>loadSchema</span><span class=o>(</span><span class=s>&#34;starWarsSchema.graphqls&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TypeDefinitionRegistry</span> <span class=n>typeRegistry</span> <span class=o>=</span> <span class=n>schemaParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>schemaFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>RuntimeWiring</span> <span class=n>wiring</span> <span class=o>=</span> <span class=n>buildRuntimeWiring</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>GraphQLSchema</span> <span class=n>graphQLSchema</span> <span class=o>=</span> <span class=n>schemaGenerator</span><span class=o>.</span><span class=na>makeExecutableSchema</span><span class=o>(</span><span class=n>typeRegistry</span><span class=o>,</span> <span class=n>wiring</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>另外在建造者模式的基础上，<code>TypeResolver</code>和<code>DataFetcher</code>可以使用<code>WiringFactory</code>接口来注入。这会允许更多的动态运行时，通过schema的定义去判断应该注入什么东西。你可以通过阅读SDL来判断生成哪种runtime。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RuntimeWiring</span> <span class=nf>buildDynamicRuntimeWiring</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>WiringFactory</span> <span class=n>dynamicWiringFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WiringFactory</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>providesTypeResolver</span><span class=o>(</span><span class=n>TypeDefinitionRegistry</span> <span class=n>registry</span><span class=o>,</span> <span class=n>InterfaceTypeDefinition</span> <span class=n>definition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>getDirective</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=s>&#34;specialMarker&#34;</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>providesTypeResolver</span><span class=o>(</span><span class=n>TypeDefinitionRegistry</span> <span class=n>registry</span><span class=o>,</span> <span class=n>UnionTypeDefinition</span> <span class=n>definition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>getDirective</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=s>&#34;specialMarker&#34;</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>TypeResolver</span> <span class=nf>getTypeResolver</span><span class=o>(</span><span class=n>TypeDefinitionRegistry</span> <span class=n>registry</span><span class=o>,</span> <span class=n>InterfaceTypeDefinition</span> <span class=n>definition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Directive</span> <span class=n>directive</span>  <span class=o>=</span> <span class=n>getDirective</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=s>&#34;specialMarker&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>createTypeResolver</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=n>directive</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>TypeResolver</span> <span class=nf>getTypeResolver</span><span class=o>(</span><span class=n>TypeDefinitionRegistry</span> <span class=n>registry</span><span class=o>,</span> <span class=n>UnionTypeDefinition</span> <span class=n>definition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Directive</span> <span class=n>directive</span>  <span class=o>=</span> <span class=n>getDirective</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=s>&#34;specialMarker&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>createTypeResolver</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=n>directive</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>providesDataFetcher</span><span class=o>(</span><span class=n>TypeDefinitionRegistry</span> <span class=n>registry</span><span class=o>,</span> <span class=n>FieldDefinition</span> <span class=n>definition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>getDirective</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=s>&#34;dataFetcher&#34;</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>DataFetcher</span> <span class=nf>getDataFetcher</span><span class=o>(</span><span class=n>TypeDefinitionRegistry</span> <span class=n>registry</span><span class=o>,</span> <span class=n>FieldDefinition</span> <span class=n>definition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Directive</span> <span class=n>directive</span> <span class=o>=</span> <span class=n>getDirective</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span> <span class=s>&#34;dataFetcher&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>createDataFetcher</span><span class=o>(</span><span class=n>definition</span><span class=o>,</span><span class=n>directive</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>RuntimeWiring</span><span class=o>.</span><span class=na>newRuntimeWiring</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>wiringFactory</span><span class=o>(</span><span class=n>dynamicWiringFactory</span><span class=o>).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=创建一个schema定义>创建一个schema定义</h2><p>当schema生成时，<code>DataFetcher</code>和<code>TypeResolver</code>可以在类型创建时提供：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>DataFetcher</span><span class=o>&lt;</span><span class=n>Foo</span><span class=o>&gt;</span> <span class=n>fooDataFetcher</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DataFetcher</span><span class=o>&lt;</span><span class=n>Foo</span><span class=o>&gt;(){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Foo</span> <span class=nf>get</span><span class=o>(</span><span class=n>DataFetchingEnvironment</span> <span class=n>environment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// environment.getSource() is the value of the surrounding
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// object. In this case described by objectType
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Foo</span> <span class=n>value</span> <span class=o>=</span> <span class=n>perhapsFromDatabase</span><span class=o>();</span> <span class=c1>// Perhaps getting from a DB or whatever
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>GraphQLObjectType</span> <span class=n>objectType</span> <span class=o>=</span> <span class=n>newObject</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;ObjectType&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newFieldDefinition</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLString</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>GraphQLCodeRegistry</span> <span class=n>codeRegistry</span> <span class=o>=</span> <span class=n>newCodeRegistry</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>dataFetcher</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>coordinates</span><span class=o>(</span><span class=s>&#34;ObjectType&#34;</span><span class=o>,</span> <span class=s>&#34;foo&#34;</span><span class=o>),</span>
</span></span><span class=line><span class=cl>                <span class=n>fooDataFetcher</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=graphql支持的类型>GraphQl支持的类型</h2><ul><li>Scalar——标量</li><li>Object——对象</li><li>Interface——接口</li><li>Union——联合</li><li>InputObject——输入对象</li><li>Enum——枚举</li></ul><h3 id=scalar>Scalar</h3><p>graphql-java支持下面几种标量：</p><h4 id=标准标量>标准标量：</h4><ul><li>GraphQLString</li><li>GraphQLBoolean</li><li>GraphQLInt</li><li>GraphQLFloat</li><li>GraphQLID</li></ul><h4 id=扩展标量>扩展标量：</h4><ul><li>GraphQLLong</li><li>GraphQLShort</li><li>GraphQLByte</li><li>GraphQLFloat(怎么重复了？)</li><li>GraphQLBigDecimal</li><li>GraphQLBigInteger</li></ul><p>**注意：你的客户端可能不能理解扩展标量的语意，比如把Java中的long(最大值26^3-1)匹配给JavaScript的Number类型(最大值2^53 - 1)可能会出问题。</p><blockquote><p>这里用了两个may be，我觉得身为一个官文，这样写是不对的。会就是会，may be什么鬼。</p></blockquote><h3 id=object>Object</h3><p>SDL Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//Simpson应该是卡通片《辛普森一家》中的一类怪物
</span></span><span class=line><span class=cl>type SimpsonCharacter {
</span></span><span class=line><span class=cl>    name: String
</span></span><span class=line><span class=cl>    mainCharacter: Boolean //是否是主角
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Java Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GraphQLObjectType</span> <span class=n>simpsonCharacter</span> <span class=o>=</span> <span class=n>newObject</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;SimpsonCharacter&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>description</span><span class=o>(</span><span class=s>&#34;A Simpson character&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newFieldDefinition</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>description</span><span class=o>(</span><span class=s>&#34;The name of the character.&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLString</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newFieldDefinition</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;mainCharacter&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>description</span><span class=o>(</span><span class=s>&#34;One of the main Simpson characters?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLBoolean</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=interface>Interface</h3><p>Interfaces 是类型的抽象定义，哇塞！</p><p>SDL Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//滑稽角色
</span></span><span class=line><span class=cl>interface ComicCharacter {
</span></span><span class=line><span class=cl>    name: String;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Java Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GraphQLInterfaceType</span> <span class=n>comicCharacter</span> <span class=o>=</span> <span class=n>newInterface</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;ComicCharacter&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>description</span><span class=o>(</span><span class=s>&#34;An abstract comic character.&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newFieldDefinition</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>description</span><span class=o>(</span><span class=s>&#34;The name of the character.&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLString</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=union>Union</h3><p>SDL Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type Cat {
</span></span><span class=line><span class=cl>    name: String;
</span></span><span class=line><span class=cl>    lives: Int;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>type Dog {
</span></span><span class=line><span class=cl>    name: String;
</span></span><span class=line><span class=cl>    bonesOwned: int;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>union Pet = Cat | Dog
</span></span></code></pre></td></tr></table></div></div><blockquote><p>我擦，《猫狗大战》</p></blockquote><p>Java Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>TypeResolver</span> <span class=n>typeResolver</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TypeResolver</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>GraphQLObjectType</span> <span class=nf>getType</span><span class=o>(</span><span class=n>TypeResolutionEnvironment</span> <span class=n>env</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>env</span><span class=o>.</span><span class=na>getObject</span><span class=o>()</span> <span class=k>instanceof</span> <span class=n>Cat</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>CatType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>env</span><span class=o>.</span><span class=na>getObject</span><span class=o>()</span> <span class=k>instanceof</span> <span class=n>Dog</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>DogType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span><span class=line><span class=cl><span class=n>GraphQLUnionType</span> <span class=n>PetType</span> <span class=o>=</span> <span class=n>newUnionType</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;Pet&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>possibleType</span><span class=o>(</span><span class=n>CatType</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>possibleType</span><span class=o>(</span><span class=n>DogType</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>GraphQLCodeRegistry</span> <span class=n>codeRegistry</span> <span class=o>=</span> <span class=n>newCodeRegistry</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>typeResolver</span><span class=o>(</span><span class=s>&#34;Pet&#34;</span><span class=o>,</span> <span class=n>typeResolver</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=enum>Enum</h3><p>SDL Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>enum Color {
</span></span><span class=line><span class=cl>    RED
</span></span><span class=line><span class=cl>    GREEN
</span></span><span class=line><span class=cl>    BLUE
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Java Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GraphQLEnumType</span> <span class=n>colorEnum</span> <span class=o>=</span> <span class=n>newEnum</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;Color&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>description</span><span class=o>(</span><span class=s>&#34;Supported colors.&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>value</span><span class=o>(</span><span class=s>&#34;RED&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>value</span><span class=o>(</span><span class=s>&#34;GREEN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>value</span><span class=o>(</span><span class=s>&#34;BLUE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=objectinputtype>ObjectInputType</h3><p>SDL Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>input Character {
</span></span><span class=line><span class=cl>    name: String
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Java Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GraphQLInputObjectType</span> <span class=n>inputObjectType</span> <span class=o>=</span> <span class=n>newInputObject</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;inputObjectType&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newInputObjectField</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;field&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLString</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=类型关系和递归>类型关系和递归</h2><p>GraphQL支持递归（哇塞！）：比如一个<code>Person</code>类内部含有一个<code>List&lt;Friend></code>，我们可以声明一个类<code>graphql-java</code>并持有一个<code>GraphQLTypeReference</code>类型的属性。当schema创建时，<code>GraphQLTypeReference</code>会被实际的类型替换掉。(答不对题，文彩太差了)。</p><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GraphQLObjectType</span> <span class=n>person</span> <span class=o>=</span> <span class=n>newObject</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;Person&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>field</span><span class=o>(</span><span class=n>newFieldDefinition</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;friends&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>type</span><span class=o>(</span><span class=n>GraphQLList</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>list</span><span class=o>(</span><span class=n>GraphQLTypeReference</span><span class=o>.</span><span class=na>typeRef</span><span class=o>(</span><span class=s>&#34;Person&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><p>当schema通过SDL创建时，不需要对递归类型做特殊处理，递归已经自动完成了。</p><blockquote><p>所以你就可以不给出个SDL的例子吗，作者？</p></blockquote><h2 id=schema-sdl-的模块化>Schema SDL 的模块化</h2><p>一个巨大的schema文件是不方便浏览的（我想起了操哥写过的300行的函数和嵌套了7层的if）。我们可以通过两种技术使之<strong>模块化</strong>。</p><p>NO.1 在逻辑单元(java代码)中合并多个Schema SDL文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>SchemaParser</span> <span class=n>schemaParser</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SchemaParser</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>SchemaGenerator</span> <span class=n>schemaGenerator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SchemaGenerator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>File</span> <span class=n>schemaFile1</span> <span class=o>=</span> <span class=n>loadSchema</span><span class=o>(</span><span class=s>&#34;starWarsSchemaPart1.graphqls&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>File</span> <span class=n>schemaFile2</span> <span class=o>=</span> <span class=n>loadSchema</span><span class=o>(</span><span class=s>&#34;starWarsSchemaPart2.graphqls&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>File</span> <span class=n>schemaFile3</span> <span class=o>=</span> <span class=n>loadSchema</span><span class=o>(</span><span class=s>&#34;starWarsSchemaPart3.graphqls&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TypeDefinitionRegistry</span> <span class=n>typeRegistry</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TypeDefinitionRegistry</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// each registry is merged into the main registry
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>typeRegistry</span><span class=o>.</span><span class=na>merge</span><span class=o>(</span><span class=n>schemaParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>schemaFile1</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>typeRegistry</span><span class=o>.</span><span class=na>merge</span><span class=o>(</span><span class=n>schemaParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>schemaFile2</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>typeRegistry</span><span class=o>.</span><span class=na>merge</span><span class=o>(</span><span class=n>schemaParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>schemaFile3</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>GraphQLSchema</span> <span class=n>graphQLSchema</span> <span class=o>=</span> <span class=n>schemaGenerator</span><span class=o>.</span><span class=na>makeExecutableSchema</span><span class=o>(</span><span class=n>typeRegistry</span><span class=o>,</span> <span class=n>buildRuntimeWiring</span><span class=o>());</span>
</span></span></code></pre></td></tr></table></div></div><p>NO.2 Graphql SDL的类型系统针对多模块具备了另一个构造函数，你可以使用<code>type extensions</code>去把额外的field和insterfaces添加到类型中。</p><p>想象你开始的时候写了这么个type：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type Human {
</span></span><span class=line><span class=cl>    id: ID!
</span></span><span class=line><span class=cl>    name: String!
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>在另一部分文件中可以通过extend这个type来添加更多的图形。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>extend type Human implements Character {
</span></span><span class=line><span class=cl>    id: ID!
</span></span><span class=line><span class=cl>    name: String!
</span></span><span class=line><span class=cl>    friends: [Character]
</span></span><span class=line><span class=cl>    appearsIn: [Episode]!
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>你可以添加更多文件，它们最终会被整合到一起（不允许重复定义字段）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>extend type Human {
</span></span><span class=line><span class=cl>    homePlanet: String
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>最终当所有type的继承者汇集到一起时，在运行时中type会变成这个样子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type Human implements Character {
</span></span><span class=line><span class=cl>    id: ID!
</span></span><span class=line><span class=cl>    name: String!
</span></span><span class=line><span class=cl>    friends: [Character]
</span></span><span class=line><span class=cl>    appearsIn: [Episode]!
</span></span><span class=line><span class=cl>    homePlanet: String
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>这在顶级中很有用，你可以使用继承来向顶级的schema「query」中添加新的字段。团队开发中可以采用这种形式来向所有的query默认提供顶级query。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>schema {
</span></span><span class=line><span class=cl>    query: CombinedQueryFromMultipleTeams
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>type CombinedQueryFromMultipleTeams {
</span></span><span class=line><span class=cl>    createdTimestamp: String
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># maybe the invoicing system team puts in this set of attributes
</span></span><span class=line><span class=cl>extend type CombinedQueryFromMultipleTeams {
</span></span><span class=line><span class=cl>    invoicing: Invoicing
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># and the billing system team puts in this set of attributes
</span></span><span class=line><span class=cl>extend type CombinedQueryFromMultipleTeams {
</span></span><span class=line><span class=cl>    billing: Billing
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># and so and so forth
</span></span><span class=line><span class=cl>extend type CombinedQueryFromMultipleTeams {
</span></span><span class=line><span class=cl>    auditing: Auditing
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h2 id=订阅支持哇塞>订阅支持(哇塞！)</h2><p>订阅允许你跑个query，并且持续监听这个query返回对象的变化。（这个牛逼了，但是有可能是靠长链接维持的，如果是的话开销就有点大了）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>subscription foo {
</span></span><span class=line><span class=cl>    # normal graphql query
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>具体请查看<a href=https://www.graphql-java.com/documentation/v16/subscriptions>Subscriptions</a>。</p><h2 id=后记>后记</h2><p>终于翻译完了，作者文彩比较渣，所以翻译的有点累。下一篇准备翻译这个<code>Subscription</code>，看看它的订阅到底是怎么回事。当然在此之前，需要对本篇翻译二次回顾，消化吸收。所以下一篇翻译不知道什么时候能搞出来了。</p><hr><p>翻译完之后的第一次校稿，发现单纯阅读这个Schema篇根本理解不了。原因是按照demo跑完入门代码后，并没有好好阅读理解逻辑，然后中间因为来活了，中断了学习和翻译，特么尴尬了。下一篇还是从quick start开始吧。</p></div></main></body></html>