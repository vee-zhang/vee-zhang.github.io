---
title: "æ ‘è“æ´¾æŒ‚è½½ç§»åŠ¨ç¡¬ç›˜"
subtitle: ""
date: 2022-01-17T17:13:10+08:00
lastmod: 2022-01-17T17:13:10+08:00
draft: false
authors: []
description: ""

tags: []
categories: []
series: []

hiddenFromHomePage: false
hiddenFromSearch: false

featuredImage: ""
featuredImagePreview: ""

toc:
  enable: true
math:
  enable: false
lightgallery: false
license: ""
---

è¿‡å¹´è¿™å‡ å¤©é¼“æ£ä¸€ä¸‹æ ‘è“æ´¾ï¼Œç»“æœå„ç§éº»çƒ¦ã€‚ã€‚ã€‚å°¤å…¶æ˜¯åœ¨æŒ‚è½½exFatæ ¼å¼çš„ç§»åŠ¨ç¡¬ç›˜çš„æ—¶å€™ï¼Œæ˜æ˜ä¸´æ—¶æŒ‚è½½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ä¸€æ—¦åšäº†å¼€æœºè‡ªåŠ¨æŒ‚è½½çš„è¯ï¼Œå°±è¿ç³»ç»Ÿéƒ½å¯åŠ¨ä¸äº†äº†ã€‚ç»è¿‡ä¸æ‡ˆçš„ç™¾åº¦ï¼Œç»ˆäºè§£å†³äº†é—®é¢˜ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚
<!--more-->

### åˆ›å»ºæŒ‚è½½ç‚¹

é¦–å…ˆè¦åˆ›å»ºæŒ‚è½½ç‚¹ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºä¸ªæ–‡ä»¶å¤¹ï¼Œç§»åŠ¨ç¡¬ç›˜ä¼šæŒ‚è½½åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ª`/mnt/servicedisk`ã€‚

```shell
sudo mkdir /mnt/servicedisk
```

ç„¶åå†æˆæƒï¼š

```
sudo chmod 777 /mnt/servicedisk
```

>ç›®å‰äº†è§£åˆ°linuxæœ‰ä¸¤ä¸ªç›®å½•æ¯”è¾ƒé€‚åˆæŒ‚è½½ç§»åŠ¨ç¡¬ç›˜ï¼Œä¸€ä¸ªæ˜¯ã€Œmediaã€ï¼Œé€‚åˆæŒ‚è½½å¤–éƒ¨å¤šåª’ä½“é©±åŠ¨ï¼Œä¸€ä¸ªæ˜¯ã€Œmntã€ï¼Œé€‚åˆæŒ‚è½½å¤–éƒ¨å‚¨å­˜è®¾å¤‡ã€‚

### ä¸´æ—¶æŒ‚è½½ç¡¬ç›˜

ä¸ºäº†æµ‹è¯•ç¡¬ç›˜æ˜¯å¦å¯ç”¨ï¼Œéœ€è¦å…ˆä¸´æ—¶æŒ‚è½½ä¸€ä¸‹ã€‚

#### æŸ¥è¯¢ç¡¬ç›˜ä¿¡æ¯

é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢å½“å‰çš„æ‰€æœ‰ç¡¬ç›˜ä¿¡æ¯ï¼š

```shell
sudo fdisk -l
```

è¿”å›ä¿¡æ¯å¦‚ä¸‹ï¼š

```
pi@raspberrypi:~ $ sudo fdisk -l
Disk /dev/ram0: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram1: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram2: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram3: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram4: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram5: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram6: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram7: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram8: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram9: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram10: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram11: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram12: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram13: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram14: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/ram15: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes


Disk /dev/mmcblk0: 119.3 GiB, 128094044160 bytes, 250183680 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x9dddeedf

Device         Boot  Start       End   Sectors  Size Id Type
/dev/mmcblk0p1        8192    532479    524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2      532480 250183679 249651200  119G 83 Linux


Disk /dev/sda: 465.76 GiB, 500107862016 bytes, 976773168 sectors
Disk model: HDD             
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 2C9DFE05-186E-4911-B369-1CED62B9A27D

Device      Start       End   Sectors   Size Type
/dev/sda1      40    409639    409600   200M EFI System
/dev/sda2  411648 976773119 976361472 465.6G Microsoft basic data
```

åœ¨æœ€ä¸‹é¢çš„`Device`ä¸€æ å°±æ˜¯å¤–éƒ¨é“¾æ¥çš„å­˜å‚¨è®¾å¤‡äº†ï¼Œæˆ‘ç›®å‰åªæ¥äº†ä¸€å—å¿†æ·çš„ç§»åŠ¨ç¡¬ç›˜ï¼Œå®ƒè‡ªå¸¦ä¸¤ä¸ªåˆ†åŒºï¼š

- /dev/sda1ï¼Œç§»åŠ¨ç¡¬ç›˜è‡ªå¸¦çš„å¼•å¯¼åˆ†åŒºï¼Œä»…æœ‰40Mï¼Œä¸èƒ½è¢«æ ¼å¼åŒ–ï¼Œä¸èƒ½åˆ é™¤ã€‚
- /dev/sda2ï¼ŒçœŸæ­£çš„å†…å®¹å‚¨å­˜ç©ºé—´ã€‚

æ¥ä¸‹æ¥æˆ‘å°±è¦æŒ‚è½½è¿™ä¸ª`/dev/sda2`äº†ã€‚

#### ä¸´æ—¶æŒ‚è½½

```
sudo mount /dev/sda2 /mnt/servicedisk

ls /mnt/servicedisk
```

å¦‚æœlså‘½ä»¤æ²¡æœ‰æŠ¥é”™ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºä¸´æ—¶æŒ‚è½½æˆåŠŸï¼

#### æŸ¥è¯¢æŒ‚è½½æƒ…å†µ

å¯ä»¥ä½¿ç”¨`df -h`å‘½ä»¤æŸ¥è¯¢æŒ‚è½½æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°`/dev/sda2`å·²ç»æˆåŠŸæŒ‚è½½åˆ°äº†å¯¹åº”çš„æŒ‚è½½ç‚¹ï¼Œ

```
pi@raspberrypi:~ $ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root       118G  1.4G  112G   2% /
devtmpfs        1.7G     0  1.7G   0% /dev
tmpfs           1.9G     0  1.9G   0% /dev/shm
tmpfs           760M  852K  759M   1% /run
tmpfs           5.0M  4.0K  5.0M   1% /run/lock
/dev/mmcblk0p1  253M   31M  222M  13% /boot
/dev/sda2       466G   11M  466G   1% /mnt/servicedisk
tmpfs           380M     0  380M   0% /run/user/1000
```

### å¼€æœºè‡ªåŠ¨æŒ‚è½½

#### æŸ¥è¯¢ç¡¬ç›˜èº«ä»½ä¿¡æ¯

```shell
$ sudo blkid /dev/sda2
/dev/sda2: LABEL="servicedisk" UUID="6201-451A" BLOCK_SIZE="512" TYPE="exfat" PARTUUID="ae27284a-b254-4bde-8a55-7457c694a22a"
```

#### ä¿®æ”¹ç³»ç»Ÿé…ç½®æ–‡ä»¶

```shell
sudo nano /etc/fstab
```

æ‰“å¼€åæ˜¯è¿™æ ·å­ï¼š

```file
PARTUUID=9dddeedf-01  /boot           vfat    defaults          0       2
PARTUUID=9dddeedf-02  /               ext4    defaults,noatime  0       1

# åœ¨æœ€åæ·»åŠ è‡ªå·±çš„ç§»åŠ¨ç¡¬ç›˜ä¿¡æ¯
PARTUUID=ae27284a-b254-4bde-8a55-7457c694a22a  /mnt/servicedisk  auto umask=0000  0  0
# a swapfile is not a swap partition, no line here
#   use  dphys-swapfile swap[on|off]  for that
```

ç„¶å`control O`ä¿å­˜,`control x`é€€å‡ºã€‚

å‘å°±åœ¨è¿™é‡Œäº†ï¼Œç½‘ä¸Šå¾ˆå¤šå¸–å­æ˜¯ç”¨UUIDæˆ–è€…ç”¨LEBALï¼Œç„¶ååé¢çš„æ ¼å¼ç”¨`exfat`æˆ–è€…`vfat`ï¼Œæˆ‘å®æµ‹ä¸‹æ¥éƒ½å¤±è´¥äº†ï¼Œé‡å¯ä¹‹åsshéƒ½è¿ä¸ä¸Šäº†ã€‚æ‰€ä»¥**è¿™é‡Œä¸€å®šè¦ç”¨`PARTUUID`å’Œ`auto`ï¼Œåé¢è¿˜è¦è·Ÿ`umask=0000`ï¼Œå››ä¸ªğŸ¥šè¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·éƒ½æœ‰è¯»å†™è¿è¡Œæƒé™ã€‚

#### æµ‹è¯•ä¸€ä¸‹

æœ€åè¿˜è¦æµ‹è¯•ä¸€ä¸‹ï¼Œä»¥å…é‡å¯ä¹‹åsshè¿ä¸ä¸Šå°±æ‚²å‰§äº†ï¼Œåªèƒ½å†é‡æ–°çƒ§å½•ç³»ç»Ÿäº†ã€‚ï¼ˆğŸ¤¦â€â™‚ï¸æˆ‘å°±å› ä¸ºä¸Šä¸€æ­¥æ²¡é…ç½®å¯¹å¯¼è‡´çƒ§å½•äº†Néç³»ç»Ÿï¼‰

```shell
sudo mount -a
```

#### é‡å¯

è¿™ä¸ªå°±ä¸ç”¨è¯´äº†ã€‚

### æŒ‚è½½åˆ°æ™®é€šç”¨æˆ·

åœ¨linuxä¸Šï¼Œç§»åŠ¨ç¡¬ç›˜ä¼šé»˜è®¤æŒ‚è½½åˆ°rootï¼Œè€Œä¸”é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯å½’å±åˆ°rootçš„ï¼Œä¸æ”¯æŒä¿®æ”¹ã€‚

è¿™å°±éº»çƒ¦äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ—¥å¸¸æ“ä½œéƒ½æ˜¯ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿›è¡Œçš„ï¼Œç”šè‡³æœ‰äº›ç¬¬ä¸‰æ–¹è½¯ä»¶ç¦æ­¢ä»¥rootèº«ä»½è¿è¡Œï¼Œæ¯”å¦‚æˆ‘æœ€è¿‘åœ¨æçš„`Gitea`ã€‚

#### æŸ¥è¯¢å½“å‰æŒ‚è½½åˆ°çš„ç”¨æˆ·

```shell
$ ls -l

-rwxr-xr-x 1 root root    808 Feb  8 15:48 docker-compose.yml
drwxr-xr-x 5 root root 131072 Feb  8 13:53 gitea
drwxr-xr-x 2 root root 131072 Feb  8 15:48 mysql
drwxr-xr-x 2 root root 131072 Feb  8 15:28 test
```

#### æŸ¥çœ‹å½“å‰æ™®é€šç”¨æˆ·çš„èº«ä»½ä¿¡æ¯

```
$id

uid=1000(pi) gid=1000(pi) groups=1000(pi),4(adm),20(dialout),24(cdrom),27(sudo),29(audio),44(video),46(plugdev),60(games),100(users),105(input),107(render),109(netdev),995(docker),997(gpio),998(i2c),999(spi)
```

å¯ä»¥çœ‹åˆ°ï¼š

- å½“å‰ç”¨æˆ·çš„uidæ˜¯1000
- å½“å‰ç”¨æˆ·çš„gid(ç”¨æˆ·ç»„id)æ˜¯1000
- dockerçš„ç”¨æˆ·ç»„idæ˜¯995

#### ä¸´æ—¶æŒ‚è½½

é¦–å…ˆå¸è½½ç¡¬ç›˜

```shell
sudo umount /dev/sda2
```

å†é‡æ–°æŒ‚è½½

```shell
sudo mount /dev/sda2 service -o uid=$id gid=995
```

ç„¶åå†æ¬¡`ls -l`æŸ¥è¯¢æŒ‚è½½ç‚¹ï¼Œå°±å‘ç°å·²ç»æŒ‚è½½åˆ°æ™®é€šç”¨æˆ·äº†ã€‚

#### å¼€æœºè‡ªåŠ¨æŒ‚è½½åˆ°ç›®æ ‡ç”¨æˆ·

åŒç†ï¼Œå¼€æœºè‡ªåŠ¨æŒ‚è½½å°±æ˜¯åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šæ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼š

```shell
PARTUUID=ae27284a-b254-4bde-8a55-7457c694a22a  /mnt/servicedisk  auto umask=0000,uid=1000,gid=995  0  0
```

é…ç½®å®Œå¯ä»¥é‡å¯è¯•ä¸€ä¸‹ï¼Œåœ¨æ ‘è“æ´¾64ä½ç³»ç»Ÿä¸Šå®æµ‹æ˜¯æˆåŠŸçš„ã€‚