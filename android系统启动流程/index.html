<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Android系统启动流程 &#183; Vee's space</title><meta name=description content="xxxx什么垃圾玩意儿，看的头疼"><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/print.css media=print><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/poole.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/syntax.css><link type=text/css rel=stylesheet href=https://vee-zhang.github.iocss/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href=https://vee-zhang.github.io/android%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/index.md rel=alternate type=text/plain title="Vee's space"></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://vee-zhang.github.io><h1>Vee's space</h1></a><p class=lead>关于 DoIt 主题</p></div><nav><ul class=sidebar-nav><li><a href=https://vee-zhang.github.io>Home</a></li><li><a href=/posts/>所有文章</a></li><li><a href=/tags/>标签</a></li><li><a href=/categories/>分类</a></li><li><a href=/series/>系列</a></li><li><a href=/about/>关于</a></li></ul></nav><p>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</p></div></aside><main class="content container"><div class=post><h1>Android系统启动流程</h1><time datetime=2021-07-28T16:15:50+0800 class=post-date>Wed, Jul 28, 2021</time><h3 id=概述>概述</h3><ol><li>启动电源时，芯片先从固定位置加载<code>BootLoader</code>并执行；</li><li>BootLoader拉起linux内核；</li><li>linux内核启动后加载<code>init.rc</code>并启动init进程；</li><li>init进程中初始化并启动<strong>属性服务</strong>并启动<code>Zygote</code>进程；</li><li>Zygote负责创建JVM，注册JNI，创建<strong>服务端Socket</strong>，最后启动<code>SystemServer</code>；</li><li>SS中创建<code>Binder线程池</code>，并启动系统服务，包括<code>AMS</code>和<code>PMS</code>；</li><li>PMS负责安装APK，AMS则启动Launcher。</li></ol><h3 id=内核空间流程>内核空间流程</h3><ol><li>按下开机键。</li><li>加载启动引导程序bootloader到内存并执行。</li><li>拉起linux内核，设置缓存，加载驱动.</li></ol><h3 id=用户空间流程>用户空间流程</h3><ol><li>内核启动后，启动init进程(pid=1)调用init的入口main函数。</li><li>创建和挂载文件目录。</li><li>初始化并启动【属性服务】。</li><li>注册子进程信号处理函数，用来处理进程终止信号，防止僵尸进程。</li><li>解析init.rc文件，并启动Zygote。</li><li>根据不同系统读取不同的init。zygotexx.rc启动zygote进程（孵化器）。</li><li>启动SystemServer</li><li>创建launcher</li></ol><h3 id=zygote启动流程>Zygote启动流程</h3><ol><li>创建JVM;</li><li>通过JNI调用<code>ZygoteInit</code>这个类的<code>main</code>函数，开始**进入java框架层*(´▽`ʃ♡ƪ)；</li><li>创建一个Socket服务端；</li><li>fork出SystemServer进程（该进程中启动系统服务）；</li><li>调用<code>zygote.runSelectLoop</code>死循环，开始监听AMS的请求。</li></ol><h3 id=systemserver的处理过程>SystemServer的处理过程</h3><p><code>SystemServer</code> 进程用来创建系统服务，如AMS、WMS和PMS等，他的处理过程为：</p><ol><li>启动Binder线程池；</li><li>创建<code>SystemServerManager</code>，用于对系统服务创建、启动和生命周期管理；</li><li>启动系统服务。</li></ol><p>这里提取一个关键点：<strong><code>SystemServerManager</code>是用来管理系统服务的</strong>。</p><h3 id=launcher启动过程>Launcher启动过程</h3><ol><li>SystemServer启动时会同时启动<code>AMS</code>和<code>PackageManagerService</code>；</li><li>而PMS启动后会安装APK；</li><li>AMS会调起Launcher；</li><li>Launcher在<code>onCreate</code>中渲染应用图标；</li></ol></div></main></body></html>